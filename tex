\documentclass  [a4paper,  16 pt] {article}
\usepackage [russian] {babel}
\usepackage [left=30 mm, top=30 mm, right=30 mm, bottom=20mm, nohead, footskip=10 mm] {geometry}
\usepackage[utf8]{inputenc}
\usepackage{setspace,amsmath}
\usepackage[colorlinks, urlcolor=blue]{hyperref}
\usepackage{graphicx}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{floatflt}
\usepackage{float}
\usepackage{wrapfig}
\linespread{1}
\usepackage{indentfirst}

\parindent=24pt


\begin{document}

\fontsize{10}{14pt}\selectfont
\begin{center}
\hfill \break
\Large{МИНОБРНАУКИ РОССИИ} \\
\hfill \break
\small {ФЕДЕРАЛЬНОЕ ГОСУДАРСТВЕННОЕ БЮДЖЕТНОЕ ОБРАЗОВАТЕЛЬНОЕ УЧРЕЖДЕНИЕ }\\
\small { ВЫСШЕГО ПРОФЕССИОНАЛЬНОГО ОБРАЗОВАНИЯ  } \\
\hfill \break
\normalsize {\textbf{ <<САНКТ-ПЕТЕРБУРГСКИЙ ПОЛИТЕХНИЧЕСКИЙ УНИВЕРСИТЕТ } }\\
\hspace{1.25cm} {\normalsize {\textbf { ПЕТРА ВЕЛИКОГО>>}}} \\
\hfill \break
\large{Институт прикладной математики и механики }\\
\hfill \break
\large{ Кафедра: <<Телематика ( при ЦНИИ РТК )>> }\\
\hfill \break
Направление 02.03.01 Математика и компьютерные науки\\
\vskip 2.5cm
\Large {Отчёт по практической работе:}
\vskip 0.3cm
\Large{Реализация игры <<Пушки>>} \\
\hfill \break
\vskip 0.8cm
\large{Группа: 3630201/90002} \\
\vskip 3cm
\end{center}


\begin {tabular}{cccc}
\hspace{0.5cm}Обучающийся: &\underline {\hspace{3cm}} &  &Маглий Екатерина Романовна \\\\
\hspace{0.5cm}Преподаватель: &\underline {\hspace{3cm}} &  &Глазунов Вадим Валерьевич \\\\
\end{tabular}
\vskip 1.5 cm
\hspace{10cm}\def \hrf#1{\hbox to#1{\hrulefill}}<<\hrf{2em}>>  \hrf{6em}  20\hrf{1em}~r.
\vskip 2.5cm
\begin {center} Санкт-Петербург 2020 \end{center}
\thispagestyle {empty}

\newpage

\begin{center}\par \bf \abstractname
\end{center}
\par Основная задача летней практики заключалась в том, чтобы познакомить студентов с кроссплатформенным фреймворком QT для разработки ПО на языке C++ . Используя знания, полученные в ходе изучения объектно-ориентированного программирования и материалы лекций по QT, было необходимо реализовать игру "Пушки". В отчете представлена данная реализация.
     
\tableofcontents 
\newpage

\section{Постановка задачи} 
\par Необходимо реализовать игру <<Пушки>>. Игра на время . Суть игры заключается в попадании во врагов посредством пушки . В начале игры враги летят сверху вниз и при помощи пушки нужно их убивать . Если пользователь не успел убить врагов ,т.е. враг дошел до низа , то проигрывает .
\par Необходимо:
\begin{enumerate}
		\item реализовать визуальное отображение этих кусочков, используя графическую библиотеку QT.
		\item реализовать элементы кнопочного интерфейса, позволяющие запускать и завершать игру.
                     \item реализовать перемещение кусочков изображения по сцене посредством использования курсора мыши.
		\item предусмотреть возможность загрузки произвольного изображения для пазла фиксированного разрешения.
	\end{enumerate}
\par  Размер изображения 600 на 600 пикселей.

\section{Реализация}
\subsection{Piece}
\par Объект класса Piece представляет собой кусочек пазла. Класс Piece имеет  поля:
\begin{verbatim} 
          class Piece
{
	int index;
	QImage* pic;
           public:
	bool pressed;
	Piece(QImage *map, int i);
	int indx();
	friend class Window;
};
\end{verbatim}
\par int index -- индекс кусочка.
\par QImage* pic -- указатель на кусочек.
\par bool pressed --  признак, показывающий, выбран ли кусочек пользователем.
\par int indx() --  метод, возвращающий значение поля index объекта, то есть номера кусочка при правильном порядке.
\par Piece(QImage *map, int i) -- конструктор класса.
\par Конструктор имеет два передаваемых параметра: map -- указатель класса QImage на исходное изображение, загруженное пользователем, и i -- индекс создаваемого кусочка по порядку.
\par  В конструкторе происходит инициализация полей объекта и вырезание из исходного изображения нужного кусочка.

\subsection{Puzzle}
\par Объект класса Puzzle -- массив, содержащий все кусочки пазла.
\par Класс Puzzle содержит поля:
\begin{verbatim} 
class Puzzle
{
	Piece* arr[36];
public:
	bool win;
	Puzzle(){}
	Puzzle(QImage *map);
	void shuffle();
	Piece *geti(int i);
public slots:
	void swapPieces(int i, int j);
};
\end{verbatim} 
\par Piece* arr[36] -- массив указателей на кусочки.
\par bool win -- признак, показывающий, находятся ли кусочки в правильном порядке, то есть собран ли пазл.
\par Puzzle(QImage *map) -- конструктор класса. Используется для создания объекта puzzle, являющимся полем класса Window, когда пользователь уже запустил игру, но не загрузил картинку. Конструктор инициализирует поле win значением false и посредством цикла инициализирует массив указателей на кусочки, вызывая для каждого элемента массива конструктор Piece и передавая ему указатель map -- исходное изображение и номер итерации, являющийся индексом создаваемого кусочка.
\par void shuffle() -- метод, перемешивающий элементы массива. Метод проходит через каждый индекс массива назад и затем меняет его со случайным индексом. Алгоритм Фишера-Йетса это более равномерно распределенная форма перетасовки. Он не перетасовывает то, что уже ранее было перетасовано.
\par Piece *geti(int i) --  метод возвращает указатель на кусочек, номер в массиве которого равен переданному параметру. Стоит отметить, что если кусочки перемешаны, то номер в массиве и индекс кусочка могут не совпадать.
\par void swapPieces(int i, int j) -- метод имеет два параметра --  номера в массиве двух кусочков. Кусочки меняются местами, значения их полей pressed меняются на false. Затем метод проверяет, собран ли пазл, сравнивая номер всех кусочков из массива и значений полей index. Если найдется хотя бы один кусочек с несовпадающими значениями, то выполнение метода заканчивается. Если все кусочки в правильном порядке, то полю win присваивается значение true.

\subsection{Window}
\par Объект класса Window -- окно, в котором происходит процесс игры. Класс является наследником стандартного класса QWidget и содержит поля: 
\begin{verbatim} 
class Window : public QWidget
{
	Q_OBJECT
	bool game;
	Puzzle puzzle;
	void paintEvent(QPaintEvent *event);
	void mouseDoubleClickEvent(QMouseEvent *event);
public:
	Window();
public slots:
		void new-game();
};
\end{verbatim} 
\par Puzzle puzzle -- объект класса Puzzle
\par bool game -- признак, показывающий, идет игра или окно находится в режиме ожидания.
\par Window() -- конструктор класса. Инициализирует поле game  значением false, задает расположение и размеры окна ( расположение: x = 300, y = 150, размер 700х700 пикселей), создает и располагает в окне кнопки <<New Game>>  и  <<Exit>>, связывает сигналы кнопок со слотами new-game()  и  close() соотвественно.
\par void mouseDoubleClickEvent(QMouseEvent *event) -- если игрок сделал двойной клик по области, в которой расположены кусочки, и игра  находится в процессе( то есть поле game имеет значение true), то метод определяет кусочек,на который кликнул игрок и меняет значение его поля pressed на противоположное. Если игрок кликнул куда-то еще или окно находится в режиме ожидания, то вызывается  родительский метод mouseDoubleClickEvent (event). Затем метод просматривает все кусочки и, как только находит два выбранных, меняет их, вызывая метод swapPieces() объекта puzzle. 
\par void paintEvent() -- метод, используемый для рисования элементов интерфейса. Сначала создается объект класса QPainter painter. Если игра находится в процессе и пазл не собран, то посредством цикла от 0 до 35 происходит рисование кусочка. В случае, если кусочек выбран, то метод отрисовывает рамку темно-синего цвета. 
\par Если же пазл собран, то метод выводит на экран сообщение <<You win!>> , иначе если пазл не собран и игра только началась метод выводит сообщение <<Welcome to puzzle!>>.
\par void new-game() -- слот предоставляет пользователю возможность загрузить изображение с компьютера. Данный слот перемешивает кусочки и начинает игру, присваивая полю game значение true.

\subsection{Элементы кнопочного интерфейса игры}
\par Игра представляет собой окно с двумя кнопками <<New Game>> (загрузить новую картинку и начать игру) и <<Exit>> ( выйти из программы), и свободным  местом, на котором во время игры располагаются кусочки или надписи <<Welcome to Puzzle!>> и <<You win>>. Кнопка  <<New Game>> связана со слотом new-game() класса Widget. Кнопка <<Exit>> связана со слотом close() класса QWidget. Перемещение кусочков осуществляется посредством двойного клика левой кнопкой мыши по двум кусочкам, которые затем меняются местами. При двойном клике на первый кусочек, он выделяется рамкой. При повторном двойном клике на тот же кусочек, выделение убирается, кусочек помечается невыбранным.

\newpage
\section{Тестирование}
\par Игра имеет 4 состояния: приветствие, процесс игры, выбран кусочек, пазл собран.

%\includegraphics[width=80mm,height=80mm]{w.jpg}
%\hspace{1.8cm}
%\includegraphics[width=100mm, height=100mm]{end.jpg}\\


\begin{figure}[h]
\centering
\includegraphics[width=80mm,height=80mm]{welcome.jpg}
\caption{Начало игры и главное меню}
\label{fig:mpr}
\end{figure}
\hfill \break

\begin{figure}[h]
\centering
\includegraphics[width=80mm,height=80mm]{pieces.jpg}
\caption{Процесс игры}
\label{fig:mpr}
\end{figure}
\newpage

\begin{figure}[h]
\centering
\includegraphics[width=80mm,height=80mm]{game.jpg}
\caption{Выбран кусочек пазла}
\label{fig:mpr}
\end{figure}
\hfill \break

\begin{figure}[h]
\centering
\includegraphics[width=80mm,height=80mm]{end.jpg}
\caption{Конец игры}
\label{fig:mpr}
\end{figure}

\newpage


\section{Заключение} 
\par В ходе выполнения практического задания были реализованы структуры данных, отвечающие за окно игры и отдельные элементы интерфейса, использован графический метод их представления из библиотеки  Qt paintEvent. 
\par Была достигнута задача данной работы - написана игра <<Puzzle>>, в которой реализованы элементы кнопочного интерфейса, позволяющие запускать и завершать игру, предусмотрена возможность загрузки произвольного изображения размером 600х600 пикселей и реализовано перемещение кусочков пазла с помощью кнопки мыши.
\par Для работы было использовано ПО: Qt 5.13.1 и MSVC 2017. 


\section{Список литературы}
\par  \url{https://www.qt.io/} - официальный сайт Qt
\par  \url{www.cyberforum.ru/qt/thread1224519.html} - Сайт cyberforum
\par \url{https://habr.com/ru/post/164721/} - Сайт Habr
%\par Были реализованы два класса с формой дизайнера QT. Класс PuzzleWidget, унаследованный от Widget, использовался в качестве родителя, так как наибольшее количество примеров с рисованием посредством метода PaintEvent использовало Widget. MainWindow унаследован от QMainWindow. С помощью дизайнера в классе MainWindow было расположено 2 объекта QFrame: frame  и  frame2. Данные объекты выполняют роль рамки, поэтому их тип QFrame. На первом расположен экземпляр класса  PuzzleWidget -- Puzzle и QWidget --  zagluska. На втором расположены 3 объекта типа QPushButton: About, exit, open.
%\par Изображение фиксированного разрешения: 800 пикселей по ширине и 600 пикселей по высоте. Размер одного кусочка: 100 на 100 пикселей. Всего 6 строк  по 8 кусочков каждый. Кусочек представляет собой структуру MinPic, где img-- само изображение кусочка (100х100), а num -- это номер кусочка, равный индексу строки, умноженному на 8 плюс номерего столбца.
%
%
%\par В классе PuzzleWidget определены следующие приватные поля:
%
%\par AllPic -- массив кусочков изображения, расположенных по порядку.
%\par PointAllPic -- массив указателей на кусочки. требуется для того, чтобы не менять местами элементы MinPic.
%\par pic -- изначальное изображение
%\par old-point -- пара чисел. Элемент с данными индексами является выделенным -- его отображение изменено. Если old_point = (-1;-1), значит никакой элемент не выделен.
%\par End -- булевая переменная. После завершения игры не позволяет менять местами кусочки.
%
%\par Приватные методы PuzzleWidget:
%
%
%\par SetupPuzzle -- перемещивает массив PointAllPic.
%\pa CheckPuzzle --  проходит весь массив PontAllPic. Если все элементы на своих местах, то есть их индекс строки, умноженный на 8, плюс номер столбца равен num элемента.
%\par SetImage -- делит изображение pic на 48 кусочков, заполняя массивы AllPic и PointAllPic. 
%\par find -- по координате клика мыши определяет индексы кусочка.
%\par paintEvent -- отрисовывает массив PointAllPic.
%\par mousePressEvent -- при нажатии на кусочек,выделяет его, если до этого никакой элемент не выделен. Если какой-либо элемент выделен, то они меняются местами (значения элементов массива PointAllPic) и никакойне явялется выделенным.
%
%\par Сигналы в классе PuzzleWidget
%
%\par PuzzleComplited -- сигнал, транслируемый из функции OpenImage в случае, если пазл собран.
%\par ImageSetted -- сигнал, транслируемый из функции OpenImage. В случае, если выбранный пользователем файл существует и имеет размер 800на 600 пикселей.
%
%
%\par В классе MainWindow реализованы 3 приватных слота: 
%\par onAboutclicked -- вызывает всплывающее сообщение с информацией о программе.
%\par GameComplited -- слот, связанный с сигналом  PuzzleComplited. Выводит сообщение с поздравлением: <<Congratulations! You have complited the puzzle!>>
%\par GameStarted -- слот, связанный с сигналом  ImageSetted. Делает видимым Puzzle и закрывает виджет zagluska, который нужен, чтобы не вводить исключения  в PaintEvent.










\end{document}
